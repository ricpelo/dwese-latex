\documentclass[a4paper,11pt]{memoir}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{bera}
\usepackage{mathpazo}
\usepackage{eulervm}
%\usepackage{lmodern}
%\usepackage{textcomp}
\usepackage[spanish,es-lcroman,es-noindentfirst]{babel}
\usepackage[pdftex]{color,graphicx}
\usepackage[xparse,minted,skins,breakable]{tcolorbox}
\usepackage[pdftex,unicode,colorlinks]{hyperref}
\usepackage{lipsum}

\chapterstyle{veelo}

\title{Prueba}
\author{Yo}

% Un tcolorbox vacío, sólo para usarlo como referencia para que las demás cajas
% usen el mismo contador:
\newtcolorbox[auto counter,number within=section]{contador}{}

% Macro que define una plantilla para crear cajas de listados de código:
\newcommand{\mitcb}[5]{%
\DeclareTCBListing[use counter from=contador]{#1}{ O{\url{code/\thetcbcounter.#2}} O{} }{%
    listing engine=minted,
    minted language=#3,
    minted options={fontsize=\small,linenos,numbersep=3mm,#5},
    listing file=code/\thetcbcounter.#2,
    run system command={./linter.sh #3 \thetcbcounter},
    colback=blue!5!white,
    colframe=red!75!black,
    listing only,
    #4,
    left=8mm,
    enhanced,
    ##2,
    title=\textbf{Listado~\thetcbcounter:} \href{code/\thetcbcounter.#2}{##1},
    before title={\hypersetup{urlcolor=blue}},
    overlay={\begin{tcbclipinterior}\fill[red!20!blue!20!white] (frame.south west)
            rectangle ([xshift=8mm]frame.north west);\end{tcbclipinterior}}}
}

% Parámetros:
% #1 : Nombre del entorno
% #2 : Extensión del archivo resultante
% #3 : Lenguaje para minted (o sea, el lexer para Pygmentize)
% #4 : Opciones adicionales para \newtcblisting
% #5 : Opciones adicionales para minted

\mitcb{php}{php}{php}{}{startinline}
\mitcb{lphp}{php}{php}{breakable}{startinline}
\mitcb{htmlphp}{php}{html+php}{}{}
\mitcb{lhtmlphp}{php}{html+php}{breakable}{}

% Macro que define una plantilla para crear listados de código que se cargan desde
% un archivo:
\newcommand{\miitcb}[5]{%
\DeclareTCBInputListing[use counter from=contador]{#1}{ O{} O{} m }{%
    listing engine=minted,
    minted language=#3,
    minted options={fontsize=\small,linenos,numbersep=3mm,#5},
    listing file=##3,
    run system command={./linter.sh #2 ##3},
    colback=blue!5!white,
    colframe=red!75!black,
    listing only,
    #4,
    left=8mm,
    enhanced,
    ##2,
    title=\textbf{Listado~\thetcbcounter:} \href{##3}{\ifthenelse{\equal{##1}{}}{##3}{##1}},
    before title={\hypersetup{urlcolor=blue}},
    overlay={\begin{tcbclipinterior}\fill[red!20!blue!20!white] (frame.south west)
            rectangle ([xshift=8mm]frame.north west);\end{tcbclipinterior}}}
}

% Parámetros:
% #1 : Nombre del comando
% #2 : Tipo de archivo para el linter
% #3 : Lenguaje para minted (o sea, el lexer para Pygmentize)
% #4 : Opciones adicionales para \newtcbinputlisting
% #5 : Opciones adicionales para minted

\miitcb{\iphp}{iphp}{php}{}{startinline}
\miitcb{\ilphp}{iphp}{php}{breakable}{startinline}
\miitcb{\ihtmlphp}{ihtmlphp}{html+php}{}{}
\miitcb{\ilhtmlphp}{ihtmlphp}{html+php}{breakable}{}

%\newtcbinputlisting[auto counter,number within=section]{\iphp}[2][]{
%    listing engine=minted,
%    minted language=php,
%    minted options={fontsize=\small,linenos,numbersep=3mm,startinline},
%    listing file=#2,
%    run system command={./linter.sh iphp #2},
%    colback=blue!5!white,
%    colframe=red!75!black,
%    listing only,
%    left=8mm,
%    enhanced,
%    title=\textbf{Listado~\thetcbcounter:} \href{#2}{\ifthenelse{\equal{#1}{}}{#2}{#1}},
%    before title={\hypersetup{urlcolor=blue}},
%    overlay={\begin{tcbclipinterior}\fill[red!20!blue!20!white] (frame.south west)
%            rectangle ([xshift=8mm]frame.north west);\end{tcbclipinterior}}}

%% Entorno para código PHP directo en cajas irrompibles (para listados cortos):
%\newtcblisting[auto counter,number within=section]{php}[1][\url{code/\thetcbcounter.php}]{
%    listing engine=minted,
%    minted language=php,
%    minted options={fontsize=\small,linenos,numbersep=3mm,startinline},
%    listing file=code/\thetcbcounter.php,
%    run system command={./linter.sh php \thetcbcounter},
%    colback=blue!5!white,
%    colframe=red!75!black,
%    listing only,
%    left=8mm,
%    enhanced,
%    title=\textbf{Listado~\thetcbcounter:} \href{code/\thetcbcounter.php}{#1},
%    before title={\hypersetup{urlcolor=blue}},
%    overlay={\begin{tcbclipinterior}\fill[red!20!blue!20!white] (frame.south west)
%            rectangle ([xshift=8mm]frame.north west);\end{tcbclipinterior}}}

%% Entorno para código PHP directo en cajas rompibles (para listados largos):
%\newtcblisting[auto counter,number within=section]{lphp}[1][\url{code/\thetcbcounter.php}]{
%    listing engine=minted,
%    minted language=php,
%    minted options={fontsize=\small,linenos,numbersep=3mm,startinline},
%    listing file=code/\thetcbcounter.php,
%    run system command={./linter.sh php \thetcbcounter},
%    colback=blue!5!white,
%    colframe=red!75!black,
%    listing only,
%    breakable,
%    left=8mm,
%    enhanced,
%    title=\textbf{Listado~\thetcbcounter:} \href{code/\thetcbcounter.php}{#1},
%    before title={\hypersetup{urlcolor=blue}},
%    overlay={\begin{tcbclipinterior}\fill[red!20!blue!20!white] (frame.south west)
%            rectangle ([xshift=8mm]frame.north west);\end{tcbclipinterior}}}

%% Entorno para código HTML+PHP directo en cajas irrompibles (para listados cortos):
%\newtcblisting[auto counter,number within=section]{htmlphp}[1][\url{code/\thetcbcounter.php}]{
%    listing engine=minted,
%    minted language=html+php,
%    minted options={fontsize=\small,linenos,numbersep=3mm,startinline},
%    listing file=code/\thetcbcounter.php,
%    run system command={./linter.sh htmlphp \thetcbcounter},
%    colback=blue!5!white,
%    colframe=red!75!black,
%    listing only,
%    left=8mm,
%    enhanced,
%    title=\textbf{Listado~\thetcbcounter:} \href{code/\thetcbcounter.php}{#1},
%    before title={\hypersetup{urlcolor=blue}},
%    overlay={\begin{tcbclipinterior}\fill[red!20!blue!20!white] (frame.south west)
%            rectangle ([xshift=8mm]frame.north west);\end{tcbclipinterior}}}

%% Entorno para código HTML+PHP directo en cajas rompibles (para listados largos):
%\newtcblisting[auto counter,number within=section]{lhtmlphp}[1][\url{code/\thetcbcounter.php}]{
%    listing engine=minted,
%    minted language=html+php,
%    minted options={fontsize=\small,linenos,numbersep=3mm,startinline},
%    listing file=code/\thetcbcounter.php,
%    run system command={./linter.sh htmlphp \thetcbcounter},
%    colback=blue!5!white,
%    colframe=red!75!black,
%    listing only,
%    breakable,
%    left=8mm,
%    enhanced,
%    title=\textbf{Listado~\thetcbcounter:} \href{code/\thetcbcounter.php}{#1},
%    before title={\hypersetup{urlcolor=blue}},
%    overlay={\begin{tcbclipinterior}\fill[red!20!blue!20!white] (frame.south west)
%            rectangle ([xshift=8mm]frame.north west);\end{tcbclipinterior}}}

\begin{document}

\frontmatter

%\maketitle
\tableofcontents

\chapter{Agradecimientos}

\mainmatter

\part{Conceptos básicos}

\chapter{Introducción}

\section{Prueba}

\lipsum

\begin{htmlphp}[Prueba][label=etiqueta]
<html>
    <body><?php
        class Articulos extends CI_Controller
        {
            public function index()
            {
                $this->load->view('articulos/index');
            }
        } ?>
    </body>
</html>
\end{htmlphp}

El ref es \ref{etiqueta}, y la página es \pageref{etiqueta}.

\begin{htmlphp}[Otra prueba]
class Articulos extends CI_Controller
{
    public function index()
    {
        $this->load->view('articulos/index');
    }
}
\end{htmlphp}

\begin{itemize}
  \item pepe
  \item juan
  \item manolo
  \begin{itemize}
    \item pepe
  \end{itemize}
\end{itemize}

\ihtmlphp[louili][label=otra]{index.php}

Aquí, el ref es \ref{otra} y la página es \pageref{otra}.

\chapter{Otro capítulo}

dfsfsdf

\end{document}
