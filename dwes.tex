\documentclass[a4paper,11pt]{memoir}
\usepackage{ifxetex}
\ifxetex
\usepackage{fontspec}
%\setmainfont{DejaVu Serif}
\setmonofont[
Path=/home/ricardo/.fonts/,
BoldFont=Inconsolata-Bold.ttf,
AutoFakeSlant,
BoldItalicFeatures={FakeSlant},
]{Inconsolata-Regular.ttf}
\usepackage{polyglossia}
\setmainlanguage{spanish}
\else
%\usepackage{mathpazo}
%\usepackage{eulervm}
%\usepackage{kpfonts}
\usepackage{lmodern}
%\usepackage{libertineRoman}
%\usepackage{mathptmx}
%\usepackage[bitstream-charter]{mathdesign}
\usepackage{textcomp}
\usepackage[scaled]{beramono}
%\usepackage[ttdefault,scale=0.98]{AnonymousPro}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[spanish,es-lcroman,es-noindentfirst]{babel}
\fi
\usepackage{color,graphicx}
\usepackage[xparse,minted,skins,breakable]{tcolorbox}
\usepackage[unicode,colorlinks,linkcolor=blue]{hyperref}
\usepackage{lipsum}

\chapterstyle{veelo}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DEFINICIONES GENERALES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\myTitle{Desarrollo web en entorno servidor}
\def\myVersion{Primera edición}
\def\myTime{Enero 2016}
\def\myName{Ricardo Pérez López}
\title{\myTitle}
\author{\myName}

\def\codigocolback{blue!5!white}
\def\codigocolframe{red!75!black}
\def\consolecolback{black!75!white}
\def\consolecolframe{black}
\def\consolecolprompt{orange}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DEFINICIONES PARA LA PORTADA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newcommand*{\plogo}{\fbox{$\mathcal{PL}$}}

\newcommand*{\titleGM}{\begingroup % Create the command for including the title page in the document
    \hbox{ % Horizontal box
        \hspace*{0.1\textwidth} % Whitespace to the left of the title page
        \rule{2pt}{\textheight} % Vertical line
        \hspace*{0.05\textwidth} % Whitespace between the vertical line and title page text
        \parbox[b]{0.75\textwidth}{ % Paragraph box which restricts text to less than the width of the page
            {\noindent\scalebox{1.7}{\HUGE\bfseries Desarrollo web}\\[1.5\baselineskip]%
                \scalebox{1.7}{\HUGE\bfseries en entorno servidor}\\[2\baselineskip]}
            {\LARGE \textsc{Ricardo Pérez López}}

            \vspace{0.5\textheight} % Whitespace between the title block and the publisher
            {\noindent\large I.E.S. Doñana}\\[\baselineskip] % Publisher and logo
        }}
        \endgroup}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DEFINICIÓN DE CAJAS INFORMATIVAS, DE LISTADOS, ETC.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Un tcolorbox vacío, sólo para usarlo como referencia para que las demás cajas
% usen el mismo contador:
\newtcolorbox[auto counter,number within=section]{contador}{}

% Macro que define una plantilla para crear cajas de listados de código:
\newcommand{\listado}[6]{%
\DeclareTCBListing[use counter from=contador]{#1}{ O{\url{code/\thetcbcounter.#6}} O{} }{
    listing engine=minted,
    minted language=#3,
    minted options={fontsize=\footnotesize,linenos,numbersep=3mm,#5},
    listing file=code/\thetcbcounter.#6,
    run system command={./linter.sh #2 \thetcbcounter.#6},
    colback=\codigocolback,
    colframe=\codigocolframe,
    fonttitle=\large\bfseries,
    listing only,
    left=8mm,
    enhanced,
    drop fuzzy shadow,
    oversize,
    adjusted title=Listado~\thetcbcounter: \href{code/\thetcbcounter.#6}{##1},
    before title={\hypersetup{urlcolor=yellow}},
    overlay={\begin{tcbclipinterior}\fill[red!20!blue!20!white] (frame.south west)
            rectangle ([xshift=8mm]frame.north west);\end{tcbclipinterior}},
    #4,
    ##2}
}

% Macro que define una plantilla para crear cajas de listados de código
% que se cargan desde un archivo:
\newcommand{\listadoinput}[5]{%
\DeclareTCBInputListing[use counter from=contador]{#1}{ O{} O{} m }{%
    listing engine=minted,
    minted language=#3,
    minted options={fontsize=\footnotesize,linenos,numbersep=3mm,#5},
    listing file=##3,
    run system command={./linter.sh #2 ##3},
    colback=\codigocolback,
    colframe=\codigocolframe,
    fonttitle=\large\bfseries,
    listing only,
    left=8mm,
    enhanced,
    drop fuzzy shadow,
    oversize,
    adjusted title=Listado~\thetcbcounter: \href{##3}{\ifthenelse{\equal{##1}{}}{##3}{##1}},
    before title={\hypersetup{urlcolor=yellow}},
    overlay={\begin{tcbclipinterior}\fill[red!20!blue!20!white] (frame.south west)
            rectangle ([xshift=8mm]frame.north west);\end{tcbclipinterior}},
    #4,
    ##2}
}

% Parámetros:
% #1 : Nombre del entorno
% #2 : Tipo de archivo para el linter
% #3 : Lenguaje para minted (o sea, el lexer para Pygmentize)
% #4 : Opciones adicionales para \newtcblisting
% #5 : Opciones adicionales para minted
% #6 : Extensión del archivo resultante

\listado{php}{php}{php}{}{startinline,firstline=3,firstnumber=1}{php}
\listado{phpnoinline}{iphp}{php}{}{}{php}
\listado{htmlphp}{htmlphp}{html+php}{}{}{php}

% Parámetros:
% #1 : Nombre del comando
% #2 : Tipo de archivo para el linter
% #3 : Lenguaje para minted (o sea, el lexer para Pygmentize)
% #4 : Opciones adicionales para \newtcbinputlisting
% #5 : Opciones adicionales para minted

\listadoinput{\iphp}{iphp}{php}{}{startinline,firstline=3,firstnumber=1}
\listadoinput{\iphpnoinline}{iphp}{php}{}{}
\listadoinput{\ihtmlphp}{htmlphp}{html+php}{}{}

% Una caja informativa genérica. De forma predeterminada, muestra el icono de
% una bombilla encendida. Si se usa la forma \caja*, no se muestra ningún icono:
\DeclareTotalTColorBox{\caja}{ s O{} O{hint} m }
    {center,width=0.9\linewidth,fonttitle=\large\bfseries,drop fuzzy shadow,
     IfBooleanTF={#1}
         {colback=green!5}%
         {bicolor,sidebyside,lefthand width=2cm,colback=green!50!black!50,
          colbacklower=green!5},
     #2}
    {\IfBooleanTF {#1}{}{\includegraphics[width=\linewidth]{iconos/#3}\tcblower}%
     \small{#4}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DEFINICIÓN DE COMANDOS PARA CÓDIGO QUE NO VA EN CAJAS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Código PHP dentro del texto:
\DeclareTotalTCBox{\phpcode}{ s m }
{verbatim,colback=\codigocolback,colframe=\codigocolframe,leftright skip=1mm}
{\mintinline{php}{#2}}

% Comandos de consola dentro del texto.
% Ejemplos:
%   \consolecode{cd /}      => $ cd /
%   \consolecode*{cd /}     => cd /
%   \consolecode[\#]{cd /}  => # cd /
%   \consolecode[$>$]{cd /} => > cd /
\DeclareTotalTCBox{\consolecode}{ s O{\$} m }
{verbatim,colupper=white,colback=\consolecolback,colframe=\consolecolframe,leftright skip=1mm}
{\IfBooleanTF {#1}{}{{\color{\consolecolprompt}#2}} \mintinline[style=vim]{sh}{#3}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OTROS COMANDOS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand\notamargen[1]{
    \marginpar{\flushright \checkoddpage
        \ifoddpage \flushleft \fi
        \emph{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CUBIERTA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\pdfpageheight297mm
\pdfpagewidth210mm

\frontmatter
\pagestyle{empty}
\pdfbookmark[-1]{Inicio}{Inicio}
\pdfbookmark[0]{Portada}{Portada}
\titleGM
\cleardoublepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PORTADA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\thispagestyle{empty}
\large
\hfill
\vfill

\begin{center}
    \color{blue}
    \scalebox{1.5}{\HUGE{Desarrollo web en}}\\[1.3\baselineskip]\scalebox{1.5}{\Huge{entorno servidor}}
\end{center}

\bigskip
\bigskip

\begin{center}
    {\LARGE{}Ricardo Pérez López}
\end{center}

\vfill
\vfill

%\begin{center}
%    D.W.E.S.
%\end{center}
%
%\vfill

\begin{center}
    {\Large I.E.S. Doñana\\[1.1\baselineskip]
    \today}
\end{center}

\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% LICENCIA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pdfbookmark[0]{Licencia}{Licencia}
\hfill

\noindent \begingroup \huge \myTitle \endgroup

\medskip

\noindent \myVersion, \myTime

\vfill
\textbf{\Large{Renuncia}}

A pesar de todos los esfuerzos que se han realizado para preparar,
revisar y corregir el contenido de este libro para garantizar su exactitud
y validez de la información contenida, este libro se proporciona <<tal
cual>>, así que el autor, así como todas las partes vinculadas
en la edición, corrección, publicación y/o distribución de la obra
no se hacen responsables por cualquier inexactitud o cualquier daño
causado, ya sea directa o indirectamente, por el uso de esta información.

\bigskip

\indent Copyright \textcopyright\ \myTime, \myName.

\bigskip

\textbf{\Large{Licencia}}

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation; with
no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.

A copy of the license is included in the section entitled \textquotedbl{}GNU
Free Documentation License\textquotedbl{} on this book.

\cleardoublepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DEDICATORIA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty}
\pdfbookmark[0]{Dedicatoria}{Dedicatoria}

\vspace*{3cm}

\begin{center}
    Lo que mueve más rápido al mundo, no son las locomotoras,\\
    Sino las ideas\\
    \medskip
    --- \textit{Miguel de Unamuno}
\end{center}

\cleardoublepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% AGRADECIMIENTOS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pdfbookmark[0]{Agradecimientos}{Agradecimientos}
\chapter*{Agradecimientos}
\thispagestyle{empty}

\lipsum[1-2]

\cleardoublepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ACERCA DEL AUTOR
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pdfbookmark[0]{Acerca del autor}{Acerca del autor}
\chapter*{Acerca del autor}
\thispagestyle{empty}

\lipsum[3-4]

\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RESUMEN DE CONTENIDO
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pdfbookmark[0]{Resumen de contenido}{Resumen de contenido}
\renewcommand{\contentsname}{Resumen de contenido}
%\begingroup \huge \myTitle \endgroup
\begingroup
\setcounter{tocdepth}{-1}
%\makeatletter
\renewcommand*\cftpartindent{0em}
\renewcommand*\cftpartnumwidth{3em}
%\makeatother
\begin{KeepFromToc}
    \tableofcontents*
\end{KeepFromToc}
\thispagestyle{empty}
\endgroup%

\cleardoublepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INDICE GENERAL
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setcounter{page}{1}
\pagestyle{ruled}
\pdfbookmark[0]{Índice general}{Indice general}
\renewcommand{\contentsname}{Índice general}

%% TOC dimensions
\cftsetindents{section}{2.5em}{3.0em}
\cftsetindents{subsection}{4.5em}{3.9em}
\cftsetindents{subsubsection}{8.4em}{4.8em}
\cftsetindents{paragraph}{10.7em}{5.7em}
\cftsetindents{subparagraph}{12.7em}{6.7em}

\makeatletter
\renewcommand*\cftpartindent{0em}
\renewcommand*\cftchapterindent{1em}
\renewcommand*\cftpartnumwidth{3em}
\renewcommand{\l@section}{\@dottedtocline{1}{2em}{2.6em}} \renewcommand{\l@subsection}{\@dottedtocline{2}{3.8em}{3.2em}} \renewcommand{\l@subsubsection}{\@dottedtocline{3}{7.0em}{4.1em}}
\makeatother
\setcounter{tocdepth}{2}

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CONTENIDO
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\mainmatter

\part{Conceptos básicos}

\chapter{Introducción}

\chapterprecis{Donde se habla de esto y de aquello.}

\section{Prueba}

Número \texttt{123456789,0} \texttt{\bfseries{123456789,0}} $123456789,0$.

\caja[adjusted title=Prueba]{\lipsum[2]}
%\caja[adjusted title=Prueba]{Esto es una prueba \phpcode{echo "hola";}}

\lipsum[2]\notamargen{mauris fklsj lfkjskljsf kl.}

\lipsum[1]

\begin{htmlphp}[Prueba][label=etiqueta,breakable]
00000000011111111112222222222333333333344444444445555555555666666666677777777778
12345678901234567890123456789012345678901234567890123456789012345678901234567890
<html>
    <body><?php
        class Articulos extends CI_Controller
        {
            public function index()
            {
                $this->load->view('articulos/index');
            }
        } ?>
    </body>
</html>
<html>
<body><?php
class Articulos extends CI_Controller
{
public function index()
{
$this->load->view('articulos/index');
}
} ?>
</body>
</html>
<html>
<body><?php
class Articulos extends CI_Controller
{
public function index()
{
$this->load->view('articulos/index');
}
} ?>
</body>
</html>
<html>
<body><?php
class Articulos extends CI_Controller
{
public function index()
{
$this->load->view('articulos/index');
}
} ?>
</body>
</html>
<html>
<body><?php
class Articulos extends CI_Controller
{
public function index()
{
$this->load->view('articulos/index');
}
} ?>
</body>
</html>
<html>
<body><?php
class Articulos extends CI_Controller
{
public function index()
{
$this->load->view('articulos/index');
}
} ?>
</body>
</html>
<html>
<body><?php
class Articulos extends CI_Controller
{
public function index()
{
$this->load->view('articulos/index');
}
} ?>
</body>
</html>
<html>
<body><?php
class Articulos extends CI_Controller
{
public function index()
{
$this->load->view('articulos/index');
}
} ?>
</body>
</html>
\end{htmlphp}

El ref es \ref{etiqueta}, y la página es \pageref{etiqueta}.

\begin{php}[Otra prueba]
class Articulos extends CI_Controller
{
    public function index()
    {
        $this->load->view('articulos/index');
    }
}
\end{php}

\begin{itemize}
  \item pepe
  \item juan
  \item manolo
  \begin{itemize}
    \item pepe
  \end{itemize}
\end{itemize}

\ihtmlphp[][label=otra]{index.php}

Aquí, el ref es \ref{otra} y la página es \pageref{otra}.

Ésto es parte de código PHP \phpcode{echo "hola";} directamente. También podemos escribir código de consola \consolecode{cd /}.

\chapter{Otro capítulo}

\tikz \draw (0pt,0pt) -- (20pt,6pt); \tikz \fill[orange] (1ex,1ex) circle (1ex); \tikz \draw (0,0) -- (1,0) -- (1,1) -- cycle;

\end{document}
